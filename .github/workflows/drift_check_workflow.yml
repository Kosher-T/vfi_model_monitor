# Phase 4: The Automation (The Manager)
name: Data Drift Monitor

# 1. THE ALARM CLOCK (Triggers)
on:
  schedule:
    - cron: '0 3 * * *'
  workflow_dispatch:

# 2. THE JOB (The Checklist)
jobs:
  run_drift_check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Build QC Monitor Image
        id: docker_build
        uses: docker/build-push-action@v5
        with:
          context: .
          push: false
          tags: vfi-monitor:latest
      
      - name: Run Drift Detection Container
        id: run_monitor
        # FIX: Mount the temp_status folder to /app/status_output
        # This way, we don't overwrite the code in /app
        run: |
          docker run \
            -v ${{ github.workspace }}/data/drifted_frames:/app/incoming_data \
            -v ${{ github.workspace }}/temp_status:/app/status_output \
            vfi-monitor:latest

      - name: Check Status and Scream if Necessary
        run: |
          # Read the file from the mounted temp_status folder
          STATUS=$(cat ${{ github.workspace }}/temp_status/status.txt)
          echo "QC Verdict: $STATUS"

          if [[ "$STATUS" == "FAIL" ]]; then
            echo "::error::ðŸš¨ High Drift Detected! The wood is bad!"
            exit 1 
          else
            echo "âœ… Data is good. Factory running smoothly."
          fi
